<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kNN ì•Œê³ ë¦¬ì¦˜ ì‹œë®¬ë ˆì´í„° - ë°•í˜¸ë¦¼ & Gemini</title>
    <style>
        /* ì „ì²´ ë ˆì´ì•„ì›ƒ ë° í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            color: #333;
        }

        /* í—¤ë” ì˜ì—­ ìŠ¤íƒ€ì¼ */
        header {
            text-align: center;
            margin-bottom: 25px;
        }
        h1 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 2rem;
        }
        .creator-badge {
            background-color: #e3f2fd; /* ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
            color: #1565c0;           /* ì§„í•œ íŒŒë€ìƒ‰ ê¸€ì”¨ */
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #bbdefb;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .controls {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            gap: 25px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            border: 1px solid #eee;
            max-width: 900px;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label { font-weight: 600; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            margin: 0 2px;
        }
        button:active { transform: scale(0.95); }

        /* ë°ì´í„° ì¶”ê°€ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        #class-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-reset { 
            background-color: #f5f5f5; 
            color: #616161; 
            border: 1px solid #e0e0e0;
        }
        .btn-reset:hover { background-color: #e0e0e0; }

        /* ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
        #canvas-container {
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
            cursor: crosshair;
            border: 2px solid #fff;
        }
        canvas { 
            background-color: white; 
            display: block; 
        }

        /* ìƒíƒœ í‘œì‹œì¤„ ìŠ¤íƒ€ì¼ */
        .status-bar {
            margin-top: 20px;
            padding: 15px 25px;
            background: white;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #555;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .prediction-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
            background-color: #ccc;
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* ì„¤ëª… íŒ¨ë„ ìŠ¤íƒ€ì¼ (ìƒˆë¡œ ì¶”ê°€ë¨) */
        .guide-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            max-width: 800px;
            width: 100%;
            padding: 25px;
            border: 1px solid #eee;
        }

        .guide-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 10px;
        }

        .guide-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            line-height: 1.6;
            color: #444;
        }

        .guide-section {
            flex: 1;
            min-width: 300px;
        }

        .guide-section h3 {
            font-size: 1.1rem;
            color: #1565c0;
            margin: 0 0 10px 0;
        }

        .guide-list {
            padding-left: 20px;
            margin: 0;
        }
        .guide-list li { margin-bottom: 8px; }

        /* ë°˜ì‘í˜• ì²˜ë¦¬ */
        @media (max-width: 700px) {
            canvas { width: 100%; height: auto; }
            .controls { flex-direction: column; gap: 15px; }
            #class-buttons { flex-wrap: wrap; justify-content: center; }
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸ” kNN (k-ìµœê·¼ì ‘ ì´ì›ƒ) ì‹œë®¬ë ˆì´í„°</h1>
        <div class="creator-badge">ì•„ì´ë””ì–´-ë°•í˜¸ë¦¼, ê°œë°œ-gemini</div>
    </header>
    
    <div class="controls">
        <div class="control-group">
            <label for="class-count">ê·¸ë£¹(í´ë˜ìŠ¤) ê°œìˆ˜: <span id="class-count-display" style="color:#333;">2</span>ê°œ</label>
            <input type="range" id="class-count" min="2" max="4" value="2">
        </div>

        <div class="control-group">
            <label for="k-value">k ê°’ (ì´ì›ƒ ìˆ˜): <span id="k-display" style="color:#29b6f6; font-size:1.2em;">3</span></label>
            <input type="range" id="k-value" min="1" max="15" step="2" value="3">
        </div>
        
        <div class="control-group">
            <span>ë°ì´í„° ì¶”ê°€:</span>
            <div id="class-buttons">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë²„íŠ¼ì´ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <button class="btn-reset" onclick="resetData()">ì´ˆê¸°í™”</button>
    </div>

    <div id="canvas-container">
        <canvas id="knnCanvas" width="800" height="500"></canvas>
    </div>

    <div class="status-bar">
        <span>í˜„ì¬ ìœ„ì¹˜ ì˜ˆì¸¡ ê²°ê³¼:</span>
        <span id="prediction-dot" class="prediction-dot"></span>
        <span id="prediction-text">ë°ì´í„° ìœ„ë¡œ ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”</span>
    </div>

    <!-- ì„¤ëª… íŒ¨ë„ ì¶”ê°€ -->
    <div class="guide-panel">
        <div class="guide-title">ğŸ’¡ kNN ì•Œê³ ë¦¬ì¦˜ì´ë€?</div>
        <div class="guide-content">
            <div class="guide-section">
                <h3>í•µì‹¬ ì›ë¦¬</h3>
                <p>
                    <strong>"ìœ ìœ ìƒì¢…"</strong>: ë¹„ìŠ·í•œ ê²ƒë¼ë¦¬ ëª¨ì¸ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.<br>
                    ìƒˆë¡œìš´ ë°ì´í„°ê°€ ë“¤ì–´ì™”ì„ ë•Œ, ê°€ì¥ ê°€ê¹Œìš´ <strong>kê°œì˜ ì´ì›ƒ</strong>ì„ ì‚´í´ë³´ê³ <br>
                    <strong>ë‹¤ìˆ˜ê²°</strong>ë¡œ ìì‹ ì˜ ê·¸ë£¹ì„ ì •í•˜ëŠ” ê°€ì¥ ì§ê´€ì ì¸ ë¨¸ì‹ ëŸ¬ë‹ ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤.
                </p>
            </div>
            <div class="guide-section">
                <h3>ì‹œë®¬ë ˆì´í„° ì‚¬ìš©ë²•</h3>
                <ul class="guide-list">
                    <li>ğŸ–±ï¸ <strong>ë§ˆìš°ìŠ¤ ì´ë™</strong>: ë§ˆìš°ìŠ¤ ì»¤ì„œê°€ 'ìƒˆë¡œìš´ ë°ì´í„°' ì—­í• ì„ í•©ë‹ˆë‹¤.</li>
                    <li>ğŸ“ <strong>ì ì„ </strong>: ê°€ì¥ ê°€ê¹Œìš´ ì´ì›ƒ(kê°œ)ë“¤ê³¼ ì—°ê²°ëœ ì„ ì…ë‹ˆë‹¤.</li>
                    <li>ğŸ“Š <strong>k ê°’ ì¡°ì ˆ</strong>: ìŠ¬ë¼ì´ë”ë¡œ íˆ¬í‘œì— ì°¸ì—¬í•  ì´ì›ƒì˜ ìˆ˜ë¥¼ ë³€ê²½í•´ ë³´ì„¸ìš”.</li>
                    <li>â• <strong>í´ë¦­</strong>: í™”ë©´ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ìœ„ì¹˜ì— í›ˆë ¨ ë°ì´í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        /**
         * kNN Simulator Logic
         * ì•„ì´ë””ì–´: ë°•í˜¸ë¦¼, ê°œë°œ: Gemini
         */

        const canvas = document.getElementById('knnCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI Elements
        const kSlider = document.getElementById('k-value');
        const kDisplay = document.getElementById('k-display');
        const classCountSlider = document.getElementById('class-count');
        const classCountDisplay = document.getElementById('class-count-display');
        const classButtonsContainer = document.getElementById('class-buttons');
        const predText = document.getElementById('prediction-text');
        const predDot = document.getElementById('prediction-dot');

        // Configuration for Classes
        const CLASS_CONFIG = [
            { id: 'red', label: 'Red', color: '#ff5252', darkColor: '#d32f2f', btnBg: '#ffebee', btnBorder: '#ffcdd2' },
            { id: 'blue', label: 'Blue', color: '#448aff', darkColor: '#1565c0', btnBg: '#e3f2fd', btnBorder: '#bbdefb' },
            { id: 'green', label: 'Green', color: '#00e676', darkColor: '#00c853', btnBg: '#e8f5e9', btnBorder: '#c8e6c9' },
            { id: 'purple', label: 'Purple', color: '#e040fb', darkColor: '#aa00ff', btnBg: '#f3e5f5', btnBorder: '#e1bee7' }
        ];

        let points = [];
        let currentMode = 'red'; // í˜„ì¬ ì„ íƒëœ ë°ì´í„° ì¶”ê°€ ëª¨ë“œ
        let mouseX = -1000;
        let mouseY = -1000;
        let activeClassCount = 2;

        // ë²„íŠ¼ UI ë™ì  ìƒì„±
        function updateClassButtons() {
            classButtonsContainer.innerHTML = '';
            for (let i = 0; i < activeClassCount; i++) {
                const config = CLASS_CONFIG[i];
                const btn = document.createElement('button');
                btn.textContent = config.label;
                btn.style.backgroundColor = config.btnBg;
                btn.style.color = config.darkColor;
                btn.style.border = `1px solid ${config.btnBorder}`;
                
                // í™œì„± ìƒíƒœ ìŠ¤íƒ€ì¼ ì ìš©
                if (currentMode === config.id) {
                    btn.style.backgroundColor = config.color;
                    btn.style.color = 'white';
                    btn.style.boxShadow = 'inset 0 0 5px rgba(0,0,0,0.2)';
                }

                btn.onclick = () => setMode(config.id);
                classButtonsContainer.appendChild(btn);
            }
        }

        // ì´ˆê¸° ë°ì´í„° ëœë¤ ìƒì„±
        function initData() {
            points = [];
            // í˜„ì¬ í™œì„±í™”ëœ í´ë˜ìŠ¤ ê°œìˆ˜ë§Œí¼ ë°˜ë³µ
            for (let i = 0; i < activeClassCount; i++) {
                const config = CLASS_CONFIG[i];
                // ê° ê·¸ë£¹ë§ˆë‹¤ ëœë¤ ìœ„ì¹˜ì— 10ê°œì”© ìƒì„±
                for(let j = 0; j < 10; j++) {
                    // ê·¸ë£¹ë³„ë¡œ ì•½ê°„ ë­‰ì³ì„œ ë‚˜ì˜¤ë„ë¡ ì¢Œí‘œ ë²”ìœ„ ì¡°ì •
                    let centerX, centerY;
                    if(i === 0) { centerX = 200; centerY = 150; }       // Red (Top-Left)
                    else if(i === 1) { centerX = 600; centerY = 350; }  // Blue (Bottom-Right)
                    else if(i === 2) { centerX = 600; centerY = 150; }  // Green (Top-Right)
                    else { centerX = 200; centerY = 350; }              // Purple (Bottom-Left)

                    points.push({ 
                        x: centerX + (Math.random() * 300 - 150), 
                        y: centerY + (Math.random() * 200 - 100), 
                        group: config.id 
                    });
                }
            }
            draw();
        }

        // ì…ë ¥ ëª¨ë“œ ë³€ê²½
        function setMode(modeId) {
            currentMode = modeId;
            updateClassButtons();
        }

        // ì´ˆê¸°í™” ë²„íŠ¼
        function resetData() {
            initData();
            updateStatus(null);
        }

        // ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³„ì‚°
        function getDistance(p1, p2) {
            return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
        }

        // kNN ì˜ˆì¸¡ ì•Œê³ ë¦¬ì¦˜ (ë‹¤ì¤‘ í´ë˜ìŠ¤ ì§€ì›)
        function predict(x, y, k) {
            if (points.length === 0) return null;

            // 1. ëª¨ë“  ì ê³¼ì˜ ê±°ë¦¬ ê³„ì‚°
            const distances = points.map(p => {
                return { ...p, dist: getDistance({x, y}, p) };
            });

            // 2. ê±°ë¦¬ìˆœ ì •ë ¬
            distances.sort((a, b) => a.dist - b.dist);

            // 3. kê°œ ì´ì›ƒ ì„ íƒ
            const neighbors = distances.slice(0, k);

            // 4. íˆ¬í‘œ (Voting)
            const votes = {};
            neighbors.forEach(n => {
                votes[n.group] = (votes[n.group] || 0) + 1;
            });

            // 5. ìµœë‹¤ ë“í‘œ ê·¸ë£¹ ì°¾ê¸°
            let maxVotes = -1;
            let winningGroup = 'Tie';
            let isTie = false;

            // í˜„ì¬ í™œì„±í™”ëœ ê·¸ë£¹ ì¤‘ì—ì„œë§Œ ë¹„êµ (í˜¹ì‹œ ë°ì´í„°ê°€ ë‚¨ì•„ìˆì„ ê²½ìš° ëŒ€ë¹„)
            for (let group in votes) {
                if (votes[group] > maxVotes) {
                    maxVotes = votes[group];
                    winningGroup = group;
                    isTie = false;
                } else if (votes[group] === maxVotes) {
                    isTie = true;
                }
            }

            return {
                group: isTie ? 'Tie' : winningGroup,
                neighbors: neighbors,
                votes: votes
            };
        }

        function updateStatus(result) {
            if (!result) {
                predText.textContent = "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
                predDot.style.backgroundColor = "#ccc";
                return;
            }

            if (result.group === 'Tie') {
                predText.textContent = "íŒë‹¨ ë¶ˆê°€ (ë™ì  ë°œìƒ)";
                predText.style.color = "#555";
                predDot.style.backgroundColor = "#aaa";
            } else {
                // ê²°ê³¼ í…ìŠ¤íŠ¸ ìƒì„± (ì˜ˆ: "Red íŒ€ ì˜ˆì¸¡ (3í‘œ)")
                const config = CLASS_CONFIG.find(c => c.id === result.group);
                const voteCount = result.votes[result.group];
                
                // ë‹¤ë¥¸ íŒ€ ë“í‘œ í˜„í™© í…ìŠ¤íŠ¸
                let details = [];
                for(let g in result.votes) {
                     const c = CLASS_CONFIG.find(item => item.id === g);
                     if(c) details.push(`${c.label} ${result.votes[g]}í‘œ`);
                }
                
                predText.textContent = `${config.label} íŒ€ ì˜ˆì¸¡ (${details.join(', ')})`;
                predText.style.color = config.darkColor;
                predDot.style.backgroundColor = config.color;
            }
        }

        // í™”ë©´ ê·¸ë¦¬ê¸°
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. ë°ì´í„° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
            points.forEach(p => {
                const config = CLASS_CONFIG.find(c => c.id === p.group);
                // ì„¤ì •ì— ì—†ëŠ” ê·¸ë£¹(ì‚­ì œëœ ê·¸ë£¹ ë“±)ì€ ê·¸ë¦¬ì§€ ì•ŠìŒ
                if(!config) return; 

                ctx.beginPath();
                ctx.arc(p.x, p.y, 7, 0, Math.PI * 2);
                ctx.fillStyle = config.color;
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            });

            // 2. ë§ˆìš°ìŠ¤ ì»¤ì„œ(Unknown Point) ë° ì˜ˆì¸¡
            const k = parseInt(kSlider.value);
            if (mouseX >= 0 && mouseY >= 0 && mouseX <= canvas.width && mouseY <= canvas.height) {
                const result = predict(mouseX, mouseY, k);

                if (result) {
                    // ì´ì›ƒ ì—°ê²°ì„ 
                    result.neighbors.forEach(n => {
                        ctx.beginPath();
                        ctx.moveTo(mouseX, mouseY);
                        ctx.lineTo(n.x, n.y);
                        ctx.strokeStyle = '#bdbdbd';
                        ctx.lineWidth = 1;
                        ctx.setLineDash([5, 5]);
                        ctx.stroke();
                        ctx.setLineDash([]);
                    });

                    // ì˜ˆì¸¡ ê²°ê³¼ ì›
                    ctx.beginPath();
                    ctx.arc(mouseX, mouseY, 12, 0, Math.PI * 2);
                    
                    if (result.group === 'Tie') {
                        ctx.fillStyle = '#9e9e9e';
                    } else {
                        const config = CLASS_CONFIG.find(c => c.id === result.group);
                        ctx.fillStyle = config ? config.color : '#333';
                    }
                    
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    updateStatus(result);
                }
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        
        // ë§ˆìš°ìŠ¤ ì´ë™
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            mouseX = (e.clientX - rect.left) * scaleX;
            mouseY = (e.clientY - rect.top) * scaleY;
            draw();
        });

        // ë§ˆìš°ìŠ¤ í´ë¦­ (ë°ì´í„° ì¶”ê°€)
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            points.push({ x, y, group: currentMode });
            draw();
        });

        canvas.addEventListener('mouseleave', () => {
            mouseX = -1000;
            mouseY = -1000;
            draw();
            predText.textContent = "ë§ˆìš°ìŠ¤ë¥¼ ìº”ë²„ìŠ¤ ìœ„ë¡œ ì˜¬ë ¤ë³´ì„¸ìš”";
            predDot.style.backgroundColor = "#ccc";
        });

        // K ê°’ ë³€ê²½
        kSlider.addEventListener('input', (e) => {
            kDisplay.textContent = e.target.value;
            draw();
        });

        // êµ°ì§‘ ê°œìˆ˜ ë³€ê²½
        classCountSlider.addEventListener('input', (e) => {
            const newVal = parseInt(e.target.value);
            if(activeClassCount !== newVal) {
                activeClassCount = newVal;
                classCountDisplay.textContent = activeClassCount;
                
                // ëª¨ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê·¸ë£¹ì¸ ê²½ìš°, ì²« ë²ˆì§¸ ê·¸ë£¹(Red)ìœ¼ë¡œ ë¦¬ì…‹
                if(currentMode === 'green' && activeClassCount < 3) currentMode = 'red';
                if(currentMode === 'purple' && activeClassCount < 4) currentMode = 'red';

                updateClassButtons();
                initData(); // ê°œìˆ˜ ë³€ê²½ ì‹œ ë°ì´í„° ë¦¬ì…‹í•˜ì—¬ í˜¼ë€ ë°©ì§€
            }
        });

        // ì´ˆê¸°í™” ì‹¤í–‰
        updateClassButtons();
        initData();
    </script>
</body>
</html>
